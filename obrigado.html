<script>
  (function() {
    const CLICKFLARE_ENDPOINT = 'https://webeasyhit.com/cf/cv'; // Endpoint ClickFlare para enviar conversão
    const PAYOUT = 10; // Ajuste para o valor do payout da sua campanha

    // Função para enviar a conversão
    function enviarConversao(clickId) {
      if (!clickId) {
        console.warn('Nenhum cf_click_id válido encontrado para enviar conversão');
        return;
      }

      // Evita múltiplos envios da mesma conversão para um mesmo clickId
      const flagConversionEnviada = 'clickflare_conversion_sent_' + clickId;
      if (localStorage.getItem(flagConversionEnviada)) {
        console.log('Conversão já enviada para clickId:', clickId);
        return;
      }

      // Envia o request para ClickFlare
      fetch(`${CLICKFLARE_ENDPOINT}?click_id=${clickId}&payout=${PAYOUT}`)
        .then(response => response.json())
        .then(data => {
          console.log('Conversão enviada para ClickFlare:', data);
          localStorage.setItem(flagConversionEnviada, 'true');
        })
        .catch(error => {
          console.error('Erro ao enviar conversão ClickFlare:', error);
        });
    }

    // Pega o cf_click_id da URL
    const urlParams = new URLSearchParams(window.location.search);
    let clickId = urlParams.get('cf_click_id');

    if (clickId) {
      // Se tiver na URL, salva no localStorage para persistir no funil
      localStorage.setItem('cf_click_id', clickId);
    } else {
      // Se não tiver na URL, tenta pegar do localStorage para casos de recarregamento
      clickId = localStorage.getItem('cf_click_id');
    }

    // Envia a conversão para ClickFlare
    enviarConversao(clickId);
  })();
</script>
